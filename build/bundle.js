module.exports=function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var o=n(2),r=n(35),i=n(5);e.exports=o.createServer(function(e,t){return i.info("Starting Logging extension - Version:","1.4.1"),r(e,t)})},function(e,t){e.exports=require("auth0-extension-tools@1.2.1")},function(e,t,n){const o=n(30),r=n(6),i=n(23),s=n(29);e.exports.createServer=o.createServer,e.exports.urlHelpers=r,e.exports.middlewares=i,e.exports.routes=s},function(e,t,n){"use strict";e.exports=n(1).config()},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";var o=n(59);o.emitErrs=!0;var r=new o.Logger({transports:[new o.transports.Console({timestamp:!0,level:"debug",handleExceptions:!0,json:!1,colorize:!0})],exitOnError:!1});e.exports=r,e.exports.stream={write:function(e){r.info(e.replace(/\n$/,""))}}},function(e,t,n){function o(e){if(!e.container)return null;const t=e.container.replace(c,"\\$&"),n=e.jtn?e.jtn.replace(c,"\\$&"):"";if(e.url_format===a)return new RegExp("^/api/run/"+t+"/(?:"+n+"/?)?");if(e.url_format===s)return new RegExp("^/"+t+"/(?:"+n+"/?)?");if(e.url_format===i)return new RegExp("^/(?:"+n+"/?)?");throw new Error("Unsupported webtask URL format.")}const r=n(18),i=3,s=2,a=1,c=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,u=function(e,t){var n=r.parse(e).pathname||"";return n=n.replace(t,"").replace(/^\/|\/$/g,""),n.startsWith("/")||(n="/"+n),n.endsWith("/")||(n+="/"),n};e.exports.getBasePath=function(e){return u(e.originalUrl||"",e.path)},e.exports.getBaseUrl=function(e,t){var n=t;const o=r.parse(e.originalUrl||"").pathname||"";return r.format({protocol:n||"https",host:e.headers.host,pathname:o.replace(e.path,"").replace(/\/$/g,"")})},e.exports.getWebtaskUrl=function(e){const t=o(e.x_wt),n=e.url,i=e.url.replace(t,"/"),s=r.parse(i||"").pathname,a=r.parse(n||"").pathname||"";var c=r.format({protocol:"https",host:e.headers.host,pathname:a.replace(s,"").replace(/\/$/g,"")});return e.x_wt&&(0===c.indexOf("https://sandbox.it.auth0.com")?c=c.replace("https://sandbox.it.auth0.com/api/run/"+e.x_wt.container+"/","https://"+e.x_wt.container+".us.webtask.io/"):0===c.indexOf("https://sandbox-eu.it.auth0.com")?c=c.replace("https://sandbox-eu.it.auth0.com/api/run/"+e.x_wt.container+"/","https://"+e.x_wt.container+".eu.webtask.io/"):0===c.indexOf("https://sandbox-au.it.auth0.com")&&(c=c.replace("https://sandbox-au.it.auth0.com/api/run/"+e.x_wt.container+"/","https://"+e.x_wt.container+".au.webtask.io/"))),c}},function(e,t,n){function o(e){if(null===e||void 0===e)throw new a.ArgumentError("Must provide an options object");if(null===e.domain||void 0===e.domain)throw new a.ArgumentError("Must provide a valid domain");if("string"!=typeof e.domain||0===e.domain.length)throw new a.ArgumentError("The provided domain is invalid: "+e.domain);if(null===e.clientId||void 0===e.clientId)throw new a.ArgumentError("Must provide a valid clientId");if("string"!=typeof e.clientId||0===e.clientId.length)throw new a.ArgumentError("The provided clientId is invalid: "+e.clientId);if(null===e.clientSecret||void 0===e.clientSecret)throw new a.ArgumentError("Must provide a valid clientSecret");if("string"!=typeof e.clientSecret||0===e.clientSecret.length)throw new a.ArgumentError("The provided clientSecret is invalid: "+e.clientSecret);this.options=e,this.tokenCache=e.tokenCache||{getToken:function(){return r.resolve()},setToken:function(){return r.resolve()}}}const r=n(12),i=n(17),s=n(16),a=n(1);o.prototype.getAccessToken=function(){var e=this;return new r(function(t,n){i.post("https://"+e.options.domain+"/oauth/token").send({audience:"https://"+e.options.domain+"/api/v2/",client_id:e.options.clientId,client_secret:e.options.clientSecret,grant_type:"client_credentials"}).set("Accept","application/json").end(function(o,r){if(o&&401===o.status)return n(new a.ManagementApiError("unauthorized","Invalid credentials for "+e.options.clientId,o.status));if(o&&r&&r.body&&r.body.error)return n(new a.ManagementApiError(r.body.error,r.body.error_description||r.body.error,o.status));if(o)return n(o);if(!r.ok||!r.body.access_token)return n(new a.ManagementApiError("unknown_error","Unknown error from Management API or no access_token was provided: "+(r.text||r.status)));const i=new Date;return t({token:r.body.access_token,expiresAt:i.setSeconds(i.getSeconds()+r.body.expires_in)})})})},o.prototype.getAccessTokenCached=function(){var e=this;return e.tokenCache.getToken().then(function(t){if(t&&t.token){const n=(new Date).valueOf();if(t.expiresAt-n>1e4)return t}return e.getAccessToken(e.options).then(function(t){return e.tokenCache.setToken(t).then(function(){return t})})})},o.prototype.getLogs=function(e){const t=this;return new r(function(n,o){t.getAccessTokenCached(t.options,t.storage).then(function(r){const c=s.stringify(e);i.get("https://"+t.options.domain+"/api/v2/logs?"+c).set("Authorization","Bearer "+r.token).set("Content-Type","application/json").end(function(e,t){return e&&t&&t.body&&t.body.error?o(new a.ManagementApiError(t.body.error,t.body.error_description||t.body.error,e.status)):e?o(e):t.ok?n({logs:t.body,limits:{limit:t.headers["x-ratelimit-limit"],remaining:t.headers["x-ratelimit-remaining"],reset:t.headers["x-ratelimit-reset"]}}):o(new a.ManagementApiError("unknown_error","Unknown error from Management API: "+(t.text||t.status)))})})})},e.exports=o},function(e,t){const n={s:{name:"Success Login",icon:"icon-budicon-448",level:1},ssa:{name:"Success Silent Auth",icon:"icon-budicon-448",level:1},fsa:{name:"Failed Silent Auth",icon:"icon-budicon-448",level:3},seacft:{name:"Success Exchange",description:"Authorization Code for Access Token",icon:"icon-budicon-456",level:1},feacft:{name:"Failed Exchange",description:"Authorization Code for Access Token",icon:"icon-budicon-456",level:3},seccft:{name:"Success Exchange",description:"Client Credentials for Access Token",icon:"icon-budicon-456",level:1},feccft:{name:"Failed Exchange",description:"Client Credentials for Access Token",icon:"icon-budicon-456",level:3},sepft:{name:"Success Exchange",description:"Password for Access Token",icon:"icon-budicon-456",level:1},fepft:{name:"Failed Exchange",description:"Password for Access Token",icon:"icon-budicon-456",level:3},sertft:{name:"Success Exchange",description:"Refresh Token for Access Token",icon:"icon-budicon-456",level:1},fertft:{name:"Failed Exchange",description:"Refresh Token for Access Token",icon:"icon-budicon-456",level:3},seoobft:{name:"Success Exchange",description:"Password and OOB Challenge for Access Token",icon:"icon-budicon-456",level:1},feoobft:{name:"Failed Exchange",description:"Password and OOB Challenge for Access Token",icon:"icon-budicon-456",level:3},seotpft:{name:"Success Exchange",description:"Password and OTP Challenge for Access Token",icon:"icon-budicon-456",level:1},feotpft:{name:"Failed Exchange",description:"Password and OTP Challenge for Access Token",icon:"icon-budicon-456",level:3},sercft:{name:"Success Exchange",description:"Password and MFA Recovery code for Access Token",icon:"icon-budicon-456",level:1},fercft:{name:"Failed Exchange",description:"Password and MFA Recovery code for Access Token",icon:"icon-budicon-456",level:3},f:{name:"Failed Login",icon:"icon-budicon-448",level:3},w:{name:"Warning",icon:"icon-budicon-354",level:2},du:{name:"Deleted User",icon:"icon-budicon-311",level:3},fu:{name:"Failed Login (invalid email/username)",icon:"icon-budicon-311",level:3},fp:{name:"Failed Login (wrong password)",icon:"icon-budicon-311",level:3},fc:{name:"Failed by Connector",icon:"icon-budicon-313",level:3},fco:{name:"Failed by CORS",icon:"icon-budicon-313",level:3},con:{name:"Connector Online",icon:"icon-budicon-143",level:1},coff:{name:"Connector Offline",icon:"icon-budicon-143",level:3},fcpro:{name:"Failed Connector Provisioning",icon:"icon-budicon-143",level:4},ss:{name:"Success Signup",icon:"icon-budicon-314",level:1},fs:{name:"Failed Signup",icon:"icon-budicon-311",level:3},cs:{name:"Code Sent",icon:"icon-budicon-243",level:1},cls:{name:"Code/Link Sent",icon:"icon-budicon-781",level:1},sv:{name:"Success Verification Email",icon:"icon-budicon-781",level:1},fv:{name:"Failed Verification Email",icon:"icon-budicon-311",level:3},scp:{name:"Success Change Password",icon:"icon-budicon-280",level:1},fcp:{name:"Failed Change Password",icon:"icon-budicon-266",level:3},sce:{name:"Success Change Email",icon:"icon-budicon-266",level:1},fce:{name:"Failed Change Email",icon:"icon-budicon-266",level:3},scu:{name:"Success Change Username",icon:"icon-budicon-266",level:1},fcu:{name:"Failed Change Username",icon:"icon-budicon-266",level:3},scpn:{name:"Success Change Phone Number",icon:"icon-budicon-266",level:1},fcpn:{name:"Failed Change Phone Number",icon:"icon-budicon-266",level:3},svr:{name:"Success Verification Email Request",icon:"icon-budicon-781",level:0},fvr:{name:"Failed Verification Email Request",icon:"icon-budicon-311",level:3},scpr:{name:"Success Change Password Request",icon:"icon-budicon-280",level:1},fcpr:{name:"Failed Change Password Request",icon:"icon-budicon-311",level:3},fn:{name:"Failed Sending Notification",icon:"icon-budicon-782",level:3},sapi:{name:"API Operation",icon:"icon-budicon-546",level:1},fapi:{name:"Failed API Operation",icon:"icon-budicon-546",level:3},limit_wc:{name:"Blocked Account",icon:"icon-budicon-313",level:4},limit_mu:{name:"Blocked IP Address",icon:"icon-budicon-313",level:4},limit_ui:{name:"Too Many Calls to /userinfo",icon:"icon-budicon-313",level:4},api_limit:{name:"Rate Limit On API",icon:"icon-budicon-313",level:4},limit_delegation:{name:"Too Many Calls to /delegation",icon:"icon-budicon-313",level:4},sdu:{name:"Successful User Deletion",icon:"icon-budicon-312",level:1},fdu:{name:"Failed User Deletion",icon:"icon-budicon-311",level:3},slo:{name:"Success Logout",icon:"icon-budicon-449",level:1},flo:{name:"Failed Logout",icon:"icon-budicon-449",level:3},sd:{name:"Success Delegation",icon:"icon-budicon-456",level:1},fd:{name:"Failed Delegation",icon:"icon-budicon-456",level:3},gd_unenroll:{name:"Unenroll device account",icon:"icon-budicon-298",level:1},gd_update_device_account:{name:"Update device account",icon:"icon-budicon-257",level:1},gd_module_switch:{name:"Module switch",icon:"icon-budicon-329",level:1},gd_tenant_update:{name:"Guardian tenant update",icon:"icon-budicon-170",level:1},gd_start_auth:{name:"Second factor started",icon:"icon-budicon-285",level:1},gd_start_enroll:{name:"Enroll started",icon:"icon-budicon-299",level:1},gd_user_delete:{name:"User delete",icon:"icon-budicon-298",level:1},gd_auth_succeed:{name:"OTP Auth suceed",icon:"icon-budicon-mfa-login-succeed",level:1},gd_auth_failed:{name:"OTP Auth failed",icon:"icon-budicon-mfa-login-failed",level:3},gd_send_pn:{name:"Push notification sent",icon:"icon-budicon-mfa-send-pn",level:1},gd_auth_rejected:{name:"OTP Auth rejected",icon:"icon-budicon-mfa-login-failed",level:3},gd_recovery_succeed:{name:"Recovery succeed",icon:"icon-budicon-mfa-recovery-succeed",level:1},gd_recovery_failed:{name:"Recovery failed",icon:"icon-budicon-mfa-recovery-failed",level:3},gd_send_sms:{name:"SMS Sent",icon:"icon-budicon-799",level:1},gd_otp_rate_limit_exceed:{name:"Too many failures",icon:"icon-budicon-435",level:2},gd_recovery_rate_limit_exceed:{name:"Too many failures",icon:"icon-budicon-435",level:2},fui:{name:"Users import",icon:"icon-budicon-299",level:2},sui:{name:"Users import",icon:"icon-budicon-299",level:1},pwd_leak:{name:"Breached password",icon:"icon-budicon-313",level:3}};e.exports=n,e.exports.get=function(e){return n[e]&&n[e].name||"Unknown Log Type: "+e}},function(e,t,n){function o(e){if(null===e||void 0===e)throw new s.ArgumentError("Must provide an options object");i.call(this,{objectMode:!0}),this.client=new a(e),this.options=e,this.remaining=50,this.lastBatch=0,this.previousCheckpoint=e.checkpointId||null,this.lastCheckpoint=e.checkpointId||null,this.status={start:new Date,end:null,logsProcessed:0}}const r=n(19),i=n(57).Readable,s=n(1),a=n(7);r.inherits(o,i),o.prototype.getQuery=function(e){return e&&e.length?"type:"+e.join(" OR type:"):""},o.prototype.done=function(){this.status.end=new Date,this.push(null)},o.prototype.next=function(e){const t=this;if(t.remaining<1)return t.status.warning="Auth0 Management API rate limit reached.",t.done();const n=t.lastCheckpoint?{take:e||100,from:t.lastCheckpoint}:{per_page:e||100,page:0};return n.q=t.getQuery(t.options.types),n.sort="date:1",t.client.getLogs(n).then(function(e){const n=e.logs;t.remaining=e.limits.remaining,n&&n.length?(t.lastCheckpoint=n[n.length-1]._id,t.lastBatch+=n.length,t.push(e)):(t.status.end=new Date,t.push(null))}).catch(function(e){t.emit("error",e)})},o.prototype.batchSaved=function(){this.status.logsProcessed+=this.lastBatch,this.previousCheckpoint=this.lastCheckpoint,this.lastBatch=0},o.prototype._read=function(){},e.exports=o},function(e,t,n){"use strict";var o=n(47);e.exports=function(e,t,n){return function(r,i,s){var a=o(s);return e===!0||"function"==typeof e&&e(r,i,a)?t(r,i,a):n?n(r,i,a):a()}}},function(e,t,n){"use strict";var o=n(45);e.exports=function(e,t){if("string"!=typeof e)throw new Error("Invalid token specified");t=t||{};var n=t.header===!0?0:1;return JSON.parse(o(e.split(".")[n]))}},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("express-jwt")},function(e,t){e.exports=require("lodash@4.8.2")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("querystring")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("util")},function(e,t,n){const o=n(11),r=n(13),i=n(1),s=n(10);e.exports=function(e){if(!e||"object"!=typeof e)throw new i.ArgumentError("Must provide the options");if(null===e.secret||void 0===e.secret)throw new i.ArgumentError("Must provide a valid secret");if("string"!=typeof e.secret||0===e.secret.length)throw new i.ArgumentError("The provided secret is invalid: "+e.secret);if(null===e.audience||void 0===e.audience)throw new i.ArgumentError("Must provide a valid secret");if("string"!=typeof e.audience||0===e.audience.length)throw new i.ArgumentError("The provided audience is invalid: "+e.audience);if(null===e.baseUrl||void 0===e.baseUrl)throw new i.ArgumentError("Must provide a valid base URL");if("string"!=typeof e.baseUrl||0===e.baseUrl.length)throw new i.ArgumentError("The provided base URL is invalid: "+e.baseUrl);const t=r({audience:e.audience,issuer:e.baseUrl,secret:e.secret,algorithms:["HS256"],credentialsRequired:e.credentialsRequired||!0});return function(n,o,r){t(n,o,function(t){return t?r(t):e.onLoginSuccess?e.onLoginSuccess(n,o,r):r()})}},e.exports.optional=function(t){const n=e.exports(t);return s(function(e){if(e&&e.headers&&e.headers.authorization&&0===e.headers.authorization.indexOf("Bearer "))try{const n=o(e.headers.authorization.split(" ")[1]);return n&&n.iss===t.baseUrl}catch(e){return!1}return!1},n)}},function(e,t,n){const o=n(11),r=n(13),i=n(55),s=n(1),a=n(10),c=n(1).UnauthorizedError;e.exports=function(e){if(!e||"object"!=typeof e)throw new s.ArgumentError("Must provide the options");if(null===e.domain||void 0===e.domain)throw new s.ArgumentError("Must provide a valid domain");if("string"!=typeof e.domain||0===e.domain.length)throw new s.ArgumentError("The provided domain is invalid: "+e.domain);if(null===e.audience||void 0===e.audience)throw new s.ArgumentError("Must provide a valid audience");if("string"!=typeof e.audience||0===e.audience.length)throw new s.ArgumentError("The provided audience is invalid: "+e.audience);const t=r({secret:i.expressJwtSecret({cache:!0,rateLimit:!0,jwksRequestsPerMinute:5,jwksUri:"https://"+e.domain+"/.well-known/jwks.json",handleSigningKeyError:function(e,t){return t(e instanceof i.SigningKeyNotFoundError?new c("A token was provided with an invalid kid"):e)}}),audience:e.audience,issuer:"https://"+e.domain+"/",algorithms:["RS256"],credentialsRequired:e&&e.credentialsRequired||!0});return function(n,o,r){t(n,o,function(t){return t?r(t):e.onLoginSuccess?e.onLoginSuccess(n,o,r):r()})}},e.exports.optional=function(t){const n=e.exports(t);return a(function(e){if(e&&e.headers&&e.headers.authorization&&0===e.headers.authorization.indexOf("Bearer "))try{const n=o(e.headers.authorization.split(" ")[1]);return n&&n.iss==="https://"+t.domain+"/"}catch(e){return!1}return!1},n)}},function(e,t,n){e.exports=function(e){return function(t,n,o,r){return e&&e(t),t&&t.status?(o.status(t.status),o.json({error:t.code||t.name,message:t.message||t.name})):(o.status(t.status||500),o.json({error:"InternalServerError",message:t.message||t.name}))}}},function(e,t,n){e.exports.authenticateAdmins=n(20),e.exports.authenticateUsers=n(21),e.exports.requireAuthentication=n(25),e.exports.errorHandler=n(22),e.exports.managementApiClient=n(24),e.exports.validateHookToken=n(26),e.exports.webtaskConfig=n(27)},function(e,t,n){const o=n(1);e.exports=function(e){return function(t,n,r){const i=t,s=t.user&&t.user.access_token&&t.user.access_token.length,a=s?{domain:e.domain,accessToken:t.user.access_token}:e;o.managementApi.getClient(a).then(function(e){return i.auth0=e,r(),null}).catch(function(e){r(e)})}}},function(e,t,n){const o=n(1).UnauthorizedError;e.exports=function(e,t,n){return e.user?n():n(new o("Authentication required for this endpoint."))}},function(e,t,n){const o=n(1);e.exports=function(e,t,n){if(null===e||void 0===e)throw new o.ArgumentError("Must provide the domain");if("string"!=typeof e||0===e.length)throw new o.ArgumentError("The provided domain is invalid: "+e);if(null===t||void 0===t)throw new o.ArgumentError("Must provide the webtaskUrl");if("string"!=typeof t||0===t.length)throw new o.ArgumentError("The provided webtaskUrl is invalid: "+t);if(null===n||void 0===n)throw new o.ArgumentError("Must provide the extensionSecret");if("string"!=typeof n||0===n.length)throw new o.ArgumentError("The provided extensionSecret is invalid: "+n);return function(r){if(null===r||void 0===r)throw new o.ArgumentError("Must provide the hookPath");if("string"!=typeof r||0===r.length)throw new o.ArgumentError("The provided hookPath is invalid: "+r);return function(i,s,a){if(i.headers.authorization&&"Bearer"===i.headers.authorization.split(" ")[0]){const c=i.headers.authorization.split(" ")[1];try{if(o.validateHookToken(e,t,r,n,c))return a()}catch(e){return a(e)}}return a(new o.HookTokenError("Hook token missing for the call to: "+r))}}}},function(e,t,n){const o=n(1);e.exports=function(e){return function(t,n,r){return t.webtaskContext&&e.setProvider(o.configProvider.fromWebtaskContext(t.webtaskContext)),r()}}},function(e,t,n){const o=n(4),r=n(51),i=n(41),s=n(1),a=n(6);e.exports=function(e){if(!e||"object"!=typeof e)throw new s.ArgumentError("Must provide the options");if(null===e.secret||void 0===e.secret)throw new s.ArgumentError("Must provide a valid secret");if("string"!=typeof e.secret||0===e.secret.length)throw new s.ArgumentError("The provided secret is invalid: "+e.secret);if(null===e.audience||void 0===e.audience)throw new s.ArgumentError("Must provide a valid secret");if("string"!=typeof e.audience||0===e.audience.length)throw new s.ArgumentError("The provided audience is invalid: "+e.audience);if(null===e.rta||void 0===e.rta)throw new s.ArgumentError("Must provide a valid rta");if("string"!=typeof e.rta||0===e.rta.length)throw new s.ArgumentError("The provided rta is invalid: "+e.rta);if(null===e.domain||void 0===e.domain)throw new s.ArgumentError("Must provide a valid domain");if("string"!=typeof e.domain||0===e.domain.length)throw new s.ArgumentError("The provided domain is invalid: "+e.domain);if(null===e.baseUrl||void 0===e.baseUrl)throw new s.ArgumentError("Must provide a valid base URL");if("string"!=typeof e.baseUrl||0===e.baseUrl.length)throw new s.ArgumentError("The provided base URL is invalid: "+e.baseUrl);if(null===e.clientName||void 0===e.clientName)throw new s.ArgumentError("Must provide a valid client name");if("string"!=typeof e.clientName||0===e.clientName.length)throw new s.ArgumentError("The provided client name is invalid: "+e.clientName);const t=e.stateKey||"state",n=e.urlPrefix||"",c=e.sessionStorageKey||"apiToken",u=o.Router();return u.get(n+"/login",function(o,i){const c=r.randomBytes(16).toString("hex");i.cookie(t,c);const u=new s.SessionManager(e.rta,e.domain,e.baseUrl),l=u.createAuthorizeUrl({redirectUri:a.getBaseUrl(o)+n+"/login/callback",scopes:e.scopes,expiration:e.expiration});i.redirect(l+"&state="+c)}),u.post(n+"/login/callback",i(),function(n,o,r){if(!n.cookies||n.cookies[t]!==n.body.state)return r(new s.ValidationError("Login failed. State mismatch."));const i=new s.SessionManager(e.rta,e.domain,e.baseUrl),u=i.create(n.body.id_token,n.body.access_token,{secret:e.secret,issuer:e.baseUrl,audience:e.audience});return u.then(function(e){o.header("Content-Type","text/html"),o.status(200).send('<html><head><script type="text/javascript">sessionStorage.setItem("'+c+'", "'+e+'");window.location.href = "'+a.getBaseUrl(n)+'";</script></head></html>')}).catch(function(e){r(e)})}),u.get(n+"/logout",function(t,n){const o=encodeURIComponent(a.getBaseUrl(t));n.header("Content-Type","text/html"),n.status(200).send('<html><head><script type="text/javascript">sessionStorage.removeItem("'+c+'");window.location.href = "https://'+e.rta+"/v2/logout/?returnTo="+o+"&client_id="+o+'";</script></head></html>')}),u.get("/.well-known/oauth2-client-configuration",function(t,o){o.header("Content-Type","application/json"),o.status(200).send({redirect_uris:[a.getBaseUrl(t)+n+"/login/callback"],client_name:e.clientName,post_logout_redirect_uris:[a.getBaseUrl(t)]})}),u}},function(e,t,n){e.exports.dashboardAdmins=n(28)},function(e,t,n){const o=n(1),r=n(58);e.exports.createServer=function(e){const t=o.createServer(e);var n=null;return r.fromExpress(function(e,o){return n||(n=t(e.webtaskContext)),n(e,o)})}},function(e,t,n){const o=n(33);e.exports.LogsProcessor=n(32),e.exports.LogsApiClient=n(7),e.exports.LogsApiStream=n(9),e.exports.logTypes=n(8),e.exports.reporters={SlackReporter:o}},function(e,t,n){function o(e,t){if(null===t||void 0===t)throw new i.ArgumentError("Must provide an options object");this.storage=new c(e),this.options=r.assign({},{batchSize:100,maxRetries:5,maxRunTimeSeconds:20},t)}const r=n(14),i=n(1),s=n(8),a=n(9),c=n(34);o.prototype.hasTimeLeft=function(e){const t=(new Date).getTime(),n=this.options.maxRunTimeSeconds;return e+1e3*n>=t},o.prototype.getLogFilter=function(e){var t=e.logTypes||[];return e.logLevel&&(t=t.concat(r.keys(r.filter(s,function(t){return t.level>=e.logLevel})))),r.uniq(t)},o.prototype.createStream=function(e){const t=this;return t.storage.getCheckpoint(e.startFrom).then(function(n){return new a({checkpointId:n,types:t.getLogFilter(e),domain:e.domain,clientId:e.clientId,clientSecret:e.clientSecret,tokenCache:t.storage})})},o.prototype.run=function(e){const t=this;return new Promise(function(n,o){const r=(new Date).getTime();var i=0,s=0,a=[];const c=t.storage,u=t.options.batchSize,l=t.options.maxRetries,d=function(e,t,r){t.error=e,c.done(t,r).then(function(){return n({status:t,checkpoint:r})}).catch(o)},p=function(e,t){if(e.logsProcessed>0){const r=6048e5,i=(new Date).getTime(),a=i-s;return a>=r&&(e.warning="Logs are outdated more than for week. Last processed log has date is "+new Date(s)),c.done(e,t).then(function(){return n({status:e,checkpoint:t})}).catch(o)}return n({status:e,checkpoint:t})},f=function(){var e=u;return e-=a.length,e>100&&(e=100),e},h=function(n,o,s){if(!t.hasTimeLeft(r))return d(n,o.status,o.previousCheckpoint);if(i<l)return i+=1,e(a,s);const c=["Skipping logs from "+o.previousCheckpoint+" to "+o.lastCheckpoint+" after "+l+" retries.",n];return d(c,o.status,o.lastCheckpoint)};t.createStream(t.options).then(function(n){n.next(f()),n.on("data",function(o){const i=o.logs;if(a=a.concat(i),i&&i.length&&(s=new Date(i[i.length-1].date).getTime()),a.length<u)return n.next(f());const c=function(e){return e?h(e,n,c):(a=[],t.hasTimeLeft(r)?(n.batchSaved(),n.next(f())):n.done())};return e(a,c)}),n.on("end",function(){const t=function(e){return e?h(e,n,t):(n.batchSaved(),p(n.status,n.lastCheckpoint))};e(a,t)}),n.on("error",function(e){d(e,n.status,n.previousCheckpoint)})}).catch(o)})},e.exports=o},function(e,t,n){function o(e){this.options=e||{}}const r=n(12),i=n(17);o.prototype.send=function(e,t){if(!e||"object"!=typeof e)throw new Error("object status is required");const n=this.options,o=this.createMessage(this.options,e,t);return new r(function(e,t){return n.hook?i.post(n.hook).send(o).set("Accept","application/json").end(function(n){return n?t(n):e()}):e()})},o.prototype.createMessage=function(e,t,n){const o={username:e.username||"auth0-logger",icon_emoji:e.icon||":rocket:",attachments:[]},r=e.title||"Auth0 Logger",i=t.error?r+" Error":r+" Success",s=t.error?t.error.message||t.error[0]||"Error occurred":null,a={fallback:e.fallback||i,text:e.text||i,fields:[{title:"Start time",value:t.start,short:!0},{title:"End time",value:t.end,short:!0},{title:"Logs processed",value:t.logsProcessed,short:!0},{title:"Last checkpoint",value:n,short:!0}],error_field:{title:"Error",value:s,short:!1}},c=e.url?" (<"+e.url+"|Details>)":null,u=a.fields;return t.error&&u.push(a.error_field),o.attachments.push({color:"#7CD197",fallback:a.fallback,text:a.fallback+(c||""),fields:u}),o},e.exports=o},function(e,t,n){function o(e,t){if(!e)throw new i("The storageContext is required");this.storageContext=e,this.options=r({},{limit:400},t)}const r=n(14).assign,i=n(1).ArgumentError;o.prototype.read=function(){const e=this;return e.storageContext.read().then(function(e){const t=e||{};return t.logs=t.logs||[],t})},o.prototype.write=function(e){const t=this;return t.storageContext.write(e)},o.prototype.getCheckpoint=function(e){const t=this;return t.read().then(function(n){return e&&e!==n.startFrom?(n.startFrom=e,n.checkpointId=e,t.write(n).then(function(){return n.checkpointId||e||null})):n.checkpointId})},o.prototype.getToken=function(){return this.read().then(function(e){return e.logs_access_token||null})},o.prototype.setToken=function(e){const t=this;return t.read().then(function(n){return n.logs_access_token=e,t.write(n)})},o.prototype.done=function(e,t){const n=this;return n.read().then(function(o){const r=Buffer.byteLength(JSON.stringify(o),"utf8");return r>=1024*n.options.limit&&o.logs&&o.logs.length&&o.logs.splice(0,5),e.checkpoint=t,o.logs.push(e),o.checkpointId=t,n.write(o)})},e.exports=o},function(e,t,n){(function(t){"use strict";var o=(n(18),n(15)),r=n(56),i=n(4),s=n(48),a=n(1),c=n(2),u=(n(2).urlHelpers,n(39)),l=n(40),d=n(37),p=n(5),f=n(3);e.exports=function(e,n){f.setProvider(e);var h=n?new a.WebtaskStorageContext(n,{force:1}):new a.FileStorageContext(o.join(t,"./data.json"),{mergeWrites:!0}),g=new i;return g.use(r(":method :url :status :response-time ms - :res[content-length]",{stream:p.stream})),g.use(s.json()),g.use(s.urlencoded({extended:!1})),g.use(c.routes.dashboardAdmins({secret:f("EXTENSION_SECRET"),audience:"urn:logs-to-mixpanel",rta:f("AUTH0_RTA").replace("https://",""),domain:f("AUTH0_DOMAIN"),baseUrl:f("PUBLIC_WT_URL"),clientName:"Logs to Mixpanel",urlPrefix:"",sessionStorageKey:"logs-to-mixpanel:apiToken",scopes:"read:logs"})),g.use("/meta",l()),g.use("/.extensions",d()),g.use("/app",i.static(o.join(t,"../dist"))),g.use("/",u(h)),g.use(c.middlewares.errorHandler(p.error.bind(p))),g}}).call(t,"/")},function(e,t,n){"use strict";var o=n(46),r=n(31),i=n(3),s=n(5);e.exports=function(e){return function(t,n,a){if(!t.body||!t.body.schedule||"active"!==t.body.state)return a();var c=function(e){return e.map(function(e){return{name:e.name,message:e.message,stack:e.stack}})},u=o.init(i("MIXPANEL_TOKEN"),{key:i("MIXPANEL_KEY")}),l=function e(t,n){t&&t.length||n(),u.import_batch(t,function(o){if(o&&o.length>0){if(t.length>10){var r=t.splice(0,10);return u.import_batch(r,function(o){return o&&o.length>0?(s.error(o),n(c(o))):(s.info(r.length+" events successfully sent to mixpanel."),e(t,n))})}return s.error(o),n(c(o))}return s.info(t.length+" events successfully sent to mixpanel."),n()})},d=function(e,t){if(!e||!e.length)return t();var n=Date.now(),o=e.map(function(e){var t=r.getLogType(e.type);return e.time=n,e.distinct_id=e.user_id||e.user_name||e.client_id||e._id,{event:t,properties:e}});l(o,t)},p=new r.reporters.SlackReporter({hook:i("SLACK_INCOMING_WEBHOOK_URL"),username:"auth0-logs-to-mixpanel",title:"Logs To Mixpanel"}),f={domain:i("AUTH0_DOMAIN"),clientId:i("AUTH0_CLIENT_ID"),clientSecret:i("AUTH0_CLIENT_SECRET"),batchSize:i("BATCH_SIZE"),startFrom:i("START_FROM"),logTypes:i("LOG_TYPES"),logLevel:i("LOG_LEVEL")},h=new r.LogsProcessor(e,f);return h.run(d).then(function(e){p.send(e.status,e.checkpoint),n.json(e)}).catch(function(e){p.send({error:e,logsProcessed:0},null),a(e)})}}},function(e,t,n){"use strict";var o=n(4).Router,r=n(2).middlewares,i=n(3),s=n(5);e.exports=function(){var e=o(),t=r.validateHookToken(i("AUTH0_DOMAIN"),i("WT_URL"),i("EXTENSION_SECRET"));return e.use("/on-uninstall",t("/.extensions/on-uninstall")),e.use(r.managementApiClient({domain:i("AUTH0_DOMAIN"),clientId:i("AUTH0_CLIENT_ID"),clientSecret:i("AUTH0_CLIENT_SECRET")})),e.delete("/on-uninstall",function(e,t){var n=i("AUTH0_CLIENT_ID");e.auth0.clients.delete({client_id:n}).then(function(){s.debug("Deleted client "+n),t.sendStatus(204)}).catch(function(e){s.debug("Error deleting client: "+i("AUTH0_CLIENT_ID")),s.error(e),t.sendStatus(204)})}),e}},function(e,t,n){(function(t){"use strict";var o=n(53),r=n(52),i=n(15),s=n(2).urlHelpers,a=n(3);e.exports=function(){var e='\n  <!DOCTYPE html>\n  <html lang="en">\n  <head>\n    <title><%= config.TITLE %></title>\n    <meta charset="UTF-8" />\n    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <link rel="shortcut icon" href="https://cdn.auth0.com/styleguide/4.6.13/lib/logos/img/favicon.png">\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styles/zocial.min.css" />\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/manage/v0.3.1672/css/index.min.css" />\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styleguide/4.6.13/index.min.css" />\n    <% if (assets.style) { %><link rel="stylesheet" type="text/css" href="/app/<%= assets.style %>" /><% } %>\n    <% if (assets.version) { %><link rel="stylesheet" type="text/css" href="//cdn.auth0.com/extensions/auth0-logs-to-mixpanel/assets/auth0-logs-to-mixpanel.ui.<%= assets.version %>.css" /><% } %>\n    <% if (assets.customCss) { %><link rel="stylesheet" type="text/css" href="<%= assets.customCss %>" /><% } %>\n  </head>\n  <body>\n    <div id="app"></div>\n    <script type="text/javascript" src="//cdn.auth0.com/w2/auth0-7.0.4.min.js"></script>\n    <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.1672/js/bundle.js"></script>\n    <script type="text/javascript">window.config = <%- JSON.stringify(config) %>;</script>\n    <% if (assets.vendors) { %><script type="text/javascript" src="<%= assets.vendors %>"></script><% } %>\n    <% if (assets.app) { %><script type="text/javascript" src="<%= assets.app %>"></script><% } %>\n    <% if (assets.version) { %>\n    <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-logs-to-mixpanel/assets/auth0-logs-to-mixpanel.ui.vendors.<%= assets.version %>.js"></script>\n    <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-logs-to-mixpanel/assets/auth0-logs-to-mixpanel.ui.<%= assets.version %>.js"></script>\n    <% } %>\n  </body>\n  </html>\n  ';return function(n,c,u){if(0===n.url.indexOf("/api"))return u();var l={AUTH0_DOMAIN:a("AUTH0_DOMAIN"),AUTH0_CLIENT_ID:a("EXTENSION_CLIENT_ID"),AUTH0_MANAGE_URL:a("AUTH0_MANAGE_URL")||"https://manage.auth0.com",
BASE_URL:s.getBaseUrl(n),BASE_PATH:s.getBasePath(n),TITLE:a("TITLE")},d="1.4.1";return d?c.send(r.render(e,{config:l,assets:{customCss:a("CUSTOM_CSS"),version:d}})):o.readFile(i.join(t,"../../dist/manifest.json"),"utf8",function(t,n){var o={config:l,assets:{customCss:a("CUSTOM_CSS"),app:"http://localhost:3000/app/bundle.js"}};!t&&n&&(o.assets=JSON.parse(n),o.assets.customCss=a("CUSTOM_CSS")),c.send(r.render(e,o))})}}}).call(t,"/")},function(e,t,n){"use strict";var o=n(4).Router,r=n(2).middlewares,i=n(3),s=n(36),a=n(38);e.exports=function(e){var t=o(),n=r.authenticateAdmins({credentialsRequired:!0,secret:i("EXTENSION_SECRET"),audience:"urn:logs-to-mixpanel",baseUrl:i("PUBLIC_WT_URL"),onLoginSuccess:function(e,t,n){return n()}});return t.get("/",a()),t.post("/",s(e)),t.get("/api/report",n,function(t,n,o){return e.read().then(function(e){return n.json(e&&e.logs||[])}).catch(o)}),t}},function(e,t,n){"use strict";var o=n(4),r=n(43);e.exports=function(){var e=o.Router();return e.get("/",function(e,t){t.status(200).send(r)}),e}},function(e,t,n){"use strict";function o(e,t){return function(n,o,r){if(n.cookies)return r();var s=n.headers.cookie,u=!e||Array.isArray(e)?e||[]:[e];return n.secret=u[0],n.cookies=Object.create(null),n.signedCookies=Object.create(null),s?(n.cookies=c.parse(s,t),0!==u.length&&(n.signedCookies=a(n.cookies,u),n.signedCookies=i(n.signedCookies)),n.cookies=i(n.cookies),void r()):r()}}function r(e){if("string"==typeof e&&"j:"===e.substr(0,2))try{return JSON.parse(e.slice(2))}catch(e){return}}function i(e){for(var t,n,o=Object.keys(e),i=0;i<o.length;i++)t=o[i],n=r(e[t]),n&&(e[t]=n);return e}function s(e,t){if("string"==typeof e){if("s:"!==e.substr(0,2))return e;for(var n=!t||Array.isArray(t)?t||[]:[t],o=0;o<n.length;o++){var r=u.unsign(e.slice(2),n[o]);if(r!==!1)return r}return!1}}function a(e,t){for(var n,o,r,i=Object.keys(e),a=Object.create(null),c=0;c<i.length;c++)o=i[c],r=e[o],n=s(r,t),r!==n&&(a[o]=n,delete e[o]);return a}var c=n(42),u=n(50);e.exports=o,e.exports.JSONCookie=r,e.exports.JSONCookies=i,e.exports.signedCookie=s,e.exports.signedCookies=a},function(e,t){"use strict";function n(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var n={},o=t||{},s=e.split(a),c=o.decode||i,u=0;u<s.length;u++){var l=s[u],d=l.indexOf("=");if(!(d<0)){var p=l.substr(0,d).trim(),f=l.substr(++d,l.length).trim();'"'==f[0]&&(f=f.slice(1,-1)),void 0==n[p]&&(n[p]=r(f,c))}}return n}function o(e,t,n){var o=n||{},r=o.encode||s;if("function"!=typeof r)throw new TypeError("option encode is invalid");if(!c.test(e))throw new TypeError("argument name is invalid");var i=r(t);if(i&&!c.test(i))throw new TypeError("argument val is invalid");var a=e+"="+i;if(null!=o.maxAge){var u=o.maxAge-0;if(isNaN(u))throw new Error("maxAge should be a Number");a+="; Max-Age="+Math.floor(u)}if(o.domain){if(!c.test(o.domain))throw new TypeError("option domain is invalid");a+="; Domain="+o.domain}if(o.path){if(!c.test(o.path))throw new TypeError("option path is invalid");a+="; Path="+o.path}if(o.expires){if("function"!=typeof o.expires.toUTCString)throw new TypeError("option expires is invalid");a+="; Expires="+o.expires.toUTCString()}if(o.httpOnly&&(a+="; HttpOnly"),o.secure&&(a+="; Secure"),o.sameSite){var l="string"==typeof o.sameSite?o.sameSite.toLowerCase():o.sameSite;switch(l){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}}return a}function r(e,t){try{return t(e)}catch(t){return e}}t.parse=n,t.serialize=o;var i=decodeURIComponent,s=encodeURIComponent,a=/; */,c=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/},function(e,t){e.exports={title:"Auth0 Logs to Mixpanel",name:"auth0-logs-to-mixpanel",version:"1.4.0",author:"auth0",description:"This extension will take all of your Auth0 logs and export them to Mixpanel",type:"cron",repository:"https://github.com/auth0/auth0-logs-to-mixpanel",keywords:["auth0","extension"],schedule:"0 */5 * * * *",auth0:{scopes:"read:logs"},secrets:{MIXPANEL_TOKEN:{description:"Mixpanel Token - this is your Mixpanel Token for your mixpanel project",required:!0},MIXPANEL_KEY:{description:"Mixpanel Key - this is your Mixpanel Key for your mixpanel project",required:!0,type:"password"},BATCH_SIZE:{description:"The amount of logs to be read on each execution. Maximum is 20.",default:10},START_FROM:{description:"CheckpointId of log to start with."},SLACK_INCOMING_WEBHOOK_URL:{description:"Slack webhook"},SLACK_SEND_SUCCESS:{description:"Send success messages to slack?",type:"select",allowMultiple:!0,options:[{value:"No",text:""},{value:"Yes",text:"true"}]},LOG_LEVEL:{description:"This allows you to specify the log level of events that need to be sent",type:"select",allowMultiple:!0,options:[{value:"-",text:""},{value:"0",text:"Debug"},{value:"1",text:"Info"},{value:"2",text:"Warning"},{value:"3",text:"Error"},{value:"4",text:"Critical"}]},LOG_TYPES:{description:"If you only want to send events with a specific type (eg: failed logins)",type:"select",allowMultiple:!0,options:[{value:"-",text:""},{value:"s",text:"Success Login (Info)"},{value:"seacft",text:"Success Exchange (Info)"},{value:"feacft",text:"Failed Exchange (Error)"},{value:"f",text:"Failed Login (Error)"},{value:"w",text:"Warnings During Login (Warning)"},{value:"du",text:"Deleted User (Info)"},{value:"fu",text:"Failed Login (invalid email/username) (Error)"},{value:"fp",text:"Failed Login (wrong password) (Error)"},{value:"fc",text:"Failed by Connector (Error)"},{value:"fco",text:"Failed by CORS (Error)"},{value:"con",text:"Connector Online (Info)"},{value:"coff",text:"Connector Offline (Error)"},{value:"fcpro",text:"Failed Connector Provisioning (Critical)"},{value:"ss",text:"Success Signup (Info)"},{value:"fs",text:"Failed Signup (Error)"},{value:"cs",text:"Code Sent (Debug)"},{value:"cls",text:"Code/Link Sent (Debug)"},{value:"sv",text:"Success Verification Email (Debug)"},{value:"fv",text:"Failed Verification Email (Debug)"},{value:"scp",text:"Success Change Password (Info)"},{value:"fcp",text:"Failed Change Password (Error)"},{value:"sce",text:"Success Change Email (Info)"},{value:"fce",text:"Failed Change Email (Error)"},{value:"scu",text:"Success Change Username (Info)"},{value:"fcu",text:"Failed Change Username (Error)"},{value:"scpn",text:"Success Change Phone Number (Info)"},{value:"fcpn",text:"Failed Change Phone Number (Error)"},{value:"svr",text:"Success Verification Email Request (Debug)"},{value:"fvr",text:"Failed Verification Email Request (Error)"},{value:"scpr",text:"Success Change Password Request (Debug)"},{value:"fcpr",text:"Failed Change Password Request (Error)"},{value:"fn",text:"Failed Sending Notification (Error)"},{value:"limit_wc",text:"Blocked Account (Critical)"},{value:"limit_ui",text:"Too Many Calls to /userinfo (Critical)"},{value:"api_limit",text:"Rate Limit On API (Critical)"},{value:"sdu",text:"Successful User Deletion (Info)"},{value:"fdu",text:"Failed User Deletion (Error)"}]}}}},function(e,t){function n(e){this.message=e}function o(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,i,s=0,a=0,c="";i=t.charAt(a++);~i&&(o=s%4?64*o+i:i,s++%4)?c+=String.fromCharCode(255&o>>(-2*s&6)):0)i=r.indexOf(i);return c}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||o},function(e,t,n){function o(e){return decodeURIComponent(r(e).replace(/(.)/g,function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}var r=n(44);e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return o(t)}catch(e){return r(t)}}},function(e,t,n){var o=n(54),r=n(16),i=n(49).Buffer,s=n(19),a=function(e,t){var n={};if(!e)throw new Error("The Mixpanel Client needs a Mixpanel token: `init(token)`");n.config={test:!1,debug:!1,verbose:!1,host:"api.mixpanel.com"},n.token=e,n.send_request=function(e,t,s){s=s||function(){};var a=new i(JSON.stringify(t)),c={data:a.toString("base64"),ip:0,verbose:n.config.verbose?1:0};if("/import"===e){var u=n.config.key;if(!u)throw new Error("The Mixpanel Client needs a Mixpanel api key when importing old events: `init(token, { key: ... })`");c.api_key=u}var l={host:n.config.host,port:n.config.port,headers:{}};n.config.test&&(c.test=1);var d=r.stringify(c);l.path=[e,"?",d].join(""),o.get(l,function(e){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){var e;if(n.config.verbose)try{var o=JSON.parse(t);1!=o.status&&(e=new Error("Mixpanel Server Error: "+o.error))}catch(t){e=new Error("Could not parse response from Mixpanel")}else e="1"!==t?new Error("Mixpanel Server Error: "+t):void 0;s(e)})}).on("error",function(e){n.config.debug&&console.log("Got Error: "+e.message),s(e)})},n.track=function(e,t,o){"function"!=typeof t&&t||(o=t,t={});var r="number"==typeof t.time?"/import":"/track";t.token=n.token,t.mp_lib="node";var i={event:e,properties:t};n.config.debug&&(console.log("Sending the following event to Mixpanel:"),console.log(i)),n.send_request(r,i,o)};var a=function(e){if(void 0===e)throw new Error("Import methods require you to specify the time of the event");return"[object Date]"===Object.prototype.toString.call(e)&&(e=Math.floor(e.getTime()/1e3)),e};n.import=function(e,t,o,r){"function"!=typeof o&&o||(r=o,o={}),o.time=a(t),n.track(e,o,r)},n.import_batch=function(e,t,o){var r=50,i=e.length,s=i,c=0,u=0,l=[];"function"!=typeof t&&t||(o=t,t={}),t.max_batch_size&&(s=t.max_batch_size,t.max_batch_size<r&&(r=t.max_batch_size));var d=function(){for(var t,s=[],p=u;p<i&&p<u+r;p++)t=e[p].properties,t.time=a(t.time),t.token||(t.token=n.token),s.push(e[p]);s.length>0&&(n.send_request("/import",s,function(e){c+=s.length,e&&l.push(e),c<i?d():o&&o(l)}),u+=r)};n.config.debug&&console.log("Sending "+e.length+" events to Mixpanel in "+Math.ceil(i/r)+" requests");for(var p=0;p<s;p+=r)d()},n.alias=function(e,t,o){var r={distinct_id:e,alias:t};n.track("$create_alias",r,o)},n.people={set_once:function(e,t,n,o,r){var i={};"object"==typeof t?("object"==typeof n?(r=o,o=n):r=n,i=t):(i[t]=n,"function"!=typeof o&&o||(r=o)),o=o||{},o.set_once=!0,this._set(e,i,r,o)},set:function(e,t,n,o,r){var i={};"object"==typeof t?("object"==typeof n?(r=o,o=n):r=n,i=t):(i[t]=n,"function"!=typeof o&&o||(r=o)),this._set(e,i,r,o)},_set:function(e,t,o,r){r=r||{};var i=r&&r.set_once?"$set_once":"$set",s={$token:n.token,$distinct_id:e};s[i]=t,"ip"in t&&(s.$ip=t.ip,delete t.ip),t.$ignore_time&&(s.$ignore_time=t.$ignore_time,delete t.$ignore_time),s=c(s,r),n.config.debug&&(console.log("Sending the following data to Mixpanel (Engage):"),console.log(s)),n.send_request("/engage",s,o)},increment:function(e,t,o,r,i){var s={};"object"==typeof t?("object"==typeof o?(i=r,r=o):i=o,Object.keys(t).forEach(function(e){var o=t[e];return isNaN(parseFloat(o))?void(n.config.debug&&(console.error("Invalid increment value passed to mixpanel.people.increment - must be a number"),console.error("Passed "+e+":"+o))):void(s[e]=o)})):"number"!=typeof o&&o?"function"==typeof o?(i=o,s[t]=1):(i=r,r="object"==typeof o?o:{},s[t]=1):(o=o||1,s[t]=o,"function"==typeof r&&(i=r));var a={$add:s,$token:n.token,$distinct_id:e};a=c(a,r),n.config.debug&&(console.log("Sending the following data to Mixpanel (Engage):"),console.log(a)),n.send_request("/engage",a,i)},append:function(e,t,o,r,i){var s={};"object"==typeof t?("object"==typeof o?(i=r,r=o):i=o,Object.keys(t).forEach(function(e){s[e]=t[e]})):(s[t]=o,"function"==typeof r&&(i=r));var a={$append:s,$token:n.token,$distinct_id:e};a=c(a,r),n.config.debug&&(console.log("Sending the following data to Mixpanel (Engage):"),console.log(a)),n.send_request("/engage",a,i)},track_charge:function(e,t,o,r,i){if("function"!=typeof o&&o?"function"!=typeof r&&r||(i=r||function(){},(o.$ignore_time||o.hasOwnProperty("$ip"))&&(r={},Object.keys(o).forEach(function(e){r[e]=o[e],delete o[e]}))):(i=o||function(){},o={}),"number"!=typeof t&&(t=parseFloat(t),isNaN(t)))return void console.error("Invalid value passed to mixpanel.people.track_charge - must be a number");if(o.$amount=t,o.hasOwnProperty("$time")){var s=o.$time;"[object Date]"===Object.prototype.toString.call(s)&&(o.$time=s.toISOString())}var a={$append:{$transactions:o},$token:n.token,$distinct_id:e};a=c(a,r),n.config.debug&&(console.log("Sending the following data to Mixpanel (Engage):"),console.log(a)),n.send_request("/engage",a,i)},clear_charges:function(e,t,o){var r={$set:{$transactions:[]},$token:n.token,$distinct_id:e};"function"==typeof t&&(o=t),r=c(r,t),n.config.debug&&console.log("Clearing this user's charges:",e),n.send_request("/engage",r,o)},delete_user:function(e,t,o){var r={$delete:"",$token:n.token,$distinct_id:e};"function"==typeof t&&(o=t),r=c(r,t),n.config.debug&&console.log("Deleting the user from engage:",e),n.send_request("/engage",r,o)},union:function(e,t,o,r){var i={};return"object"!=typeof t||s.isArray(t)?void(n.config.debug&&console.error("Invalid value passed to mixpanel.people.union - data must be an object with array values")):(Object.keys(t).forEach(function(e){var o=t[e];if(s.isArray(o)){var r=o.filter(function(e){return"string"==typeof e||"number"==typeof e});r.length>0&&(i[e]=r)}else{if("string"!=typeof o&&"number"!=typeof o)return void(n.config.debug&&(console.error("Invalid argument passed to mixpanel.people.union - values must be a scalar value or array"),console.error("Passed "+e+":",o)));i[e]=[o]}}),void(0!==Object.keys(i).length&&(t={$union:i,$token:n.token,$distinct_id:e},"function"==typeof o&&(r=o),t=c(t,o),n.config.debug&&(console.log("Sending the following data to Mixpanel (Engage):"),console.log(t)),n.send_request("/engage",t,r))))},unset:function(e,t,o,r){var i=[];if(s.isArray(t))i=t;else{if("string"!=typeof t)return void(n.config.debug&&(console.error("Invalid argument passed to mixpanel.people.unset - must be a string or array"),console.error("Passed: "+t)));i=[t]}var a={$unset:i,$token:n.token,$distinct_id:e};"function"==typeof o&&(r=o),a=c(a,o),n.config.debug&&(console.log("Sending the following data to Mixpanel (Engage):"),console.log(a)),n.send_request("/engage",a,r)}};var c=function(e,t){return t&&(t.$ignore_alias&&(e.$ignore_alias=t.$ignore_alias),t.$ignore_time&&(e.$ignore_time=t.$ignore_time),t.hasOwnProperty("$ip")&&(e.$ip=t.$ip),t.hasOwnProperty("$time")&&(e.$time=a(t.$time))),e};return n.set_config=function(e){for(var t in e)if(e.hasOwnProperty(t))if("host"==t){n.config.host=e[t].split(":")[0];var o=e[t].split(":")[1];o&&(n.config.port=Number(o))}else n.config[t]=e[t]},t&&n.set_config(t),n};e.exports={Client:function(e){return console.warn("The function `Client(token)` is deprecated.  It is now called `init(token)`."),a(e)},init:a}},function(e,t,n){function o(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function r(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},n=e.name||"Function wrapped with `once`";return t.onceError=n+" shouldn't be called more than once",t.called=!1,t}var i=n(60);e.exports=i(o),e.exports.strict=i(r),o.proto=o(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return o(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return r(this)},configurable:!0})})},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("buffer")},function(e,t){e.exports=require("cookie-signature")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("ejs")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("jwks-rsa@1.1.1")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("stream")},function(e,t){e.exports=require("webtask-tools")},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("wrappy")}]);